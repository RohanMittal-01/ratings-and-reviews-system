openapi: 3.0.3
info:
  title: Ratings and Reviews System API
  description: |
    A PlayStore-like Application system where users can add ratings and reviews/comments to applications.
    
    ## Features
    - User ratings management (1-5 stars)
    - Comments and reviews with sentiment analysis
    - Application installation tracking
    - Health monitoring endpoints
  version: 1.0.0
  contact:
    name: Ratings and Reviews System
    url: https://github.com/RohanMittal-01/ratings-and-reviews-system
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:8080/api
    description: Local development server
  - url: https://api.example.com/api
    description: Production server

tags:
  - name: Health
    description: Health check endpoints
  - name: Applications
    description: Application management operations
  - name: Ratings
    description: Rating operations
  - name: Comments
    description: Comment and review operations

paths:
  /health:
    get:
      tags:
        - Health
      summary: Basic health check
      description: Returns the health status of the application
      operationId: healthCheck
      responses:
        '200':
          description: Application is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
              example:
                status: "UP"
                application: "Ratings and Reviews System"
                version: "1.0.0"

  /health/db:
    get:
      tags:
        - Health
      summary: Database health check
      description: Returns the health status of the database connection and pool
      operationId: databaseHealthCheck
      responses:
        '200':
          description: Database is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DatabaseHealthResponse'
              example:
                status: "UP"
                database: "PostgreSQL"
                totalConnections: 10
                activeConnections: 2
                idleConnections: 8
        '503':
          description: Database is down
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DatabaseHealthResponse'
              example:
                status: "DOWN"
                error: "Connection timeout"

  /v1/applications/{applicationId}:
    get:
      tags:
        - Applications
      summary: Get application by ID
      description: Retrieve details of a specific application
      operationId: getApplication
      parameters:
        - name: applicationId
          in: path
          required: true
          description: The unique identifier of the application
          schema:
            type: string
      responses:
        '200':
          description: Application details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Application'
        '404':
          description: Application not found

  /v1/applications:
    get:
      tags:
        - Applications
      summary: Get paginated applications
      description: Retrieve a paginated list of applications with optional filtering and sorting
      operationId: getApplications
      parameters:
        - name: filterKey
          in: query
          required: false
          description: Field to filter by (e.g., 'name')
          schema:
            type: string
        - name: filterValue
          in: query
          required: false
          description: Value to filter by
          schema:
            type: string
        - name: sortBy
          in: query
          required: false
          description: Field to sort by
          schema:
            type: string
            default: updatedAt
        - name: order
          in: query
          required: false
          description: Sort order
          schema:
            type: string
            enum: [asc, desc]
            default: desc
        - name: page
          in: query
          required: false
          description: Page number (0-indexed)
          schema:
            type: integer
            minimum: 0
            default: 0
        - name: size
          in: query
          required: false
          description: Page size
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
      responses:
        '200':
          description: Paginated list of applications
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApplicationPage'

  /v1/applications/install:
    post:
      tags:
        - Applications
      summary: Install an application
      description: Mark an application as installed for the user
      operationId: installApplication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ApplicationIdRequest'
            example:
              applicationId: "123e4567-e89b-12d3-a456-426614174000"
      responses:
        '200':
          description: Application installed successfully
        '404':
          description: Application not found

  /v1/applications/install/batch:
    post:
      tags:
        - Applications
      summary: Install multiple applications
      description: Mark multiple applications as installed for the user
      operationId: installApplications
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ApplicationIdsRequest'
            example:
              applicationIds:
                - "123e4567-e89b-12d3-a456-426614174000"
                - "223e4567-e89b-12d3-a456-426614174001"
      responses:
        '200':
          description: Applications installed successfully

  /v1/applications/uninstall:
    post:
      tags:
        - Applications
      summary: Uninstall an application
      description: Mark an application as uninstalled for the user
      operationId: uninstallApplication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ApplicationIdRequest'
      responses:
        '200':
          description: Application uninstalled successfully
        '404':
          description: Application not found

  /v1/applications/uninstall/batch:
    post:
      tags:
        - Applications
      summary: Uninstall multiple applications
      description: Mark multiple applications as uninstalled for the user
      operationId: uninstallApplications
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ApplicationIdsRequest'
      responses:
        '200':
          description: Applications uninstalled successfully

  /v1/ratings/{applicationId}:
    get:
      tags:
        - Ratings
      summary: Get ratings for an application
      description: Retrieve paginated ratings for a specific application
      operationId: getRatingsByApplicationId
      parameters:
        - name: applicationId
          in: path
          required: true
          description: The unique identifier of the application
          schema:
            type: string
            format: uuid
        - name: page
          in: query
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
        - name: size
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
        - name: sortBy
          in: query
          required: false
          schema:
            type: string
            default: updatedAt
        - name: order
          in: query
          required: false
          schema:
            type: string
            enum: [asc, desc]
            default: desc
      responses:
        '200':
          description: Paginated list of ratings
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RatingPage'

  /v1/ratings/average/{applicationId}:
    get:
      tags:
        - Ratings
      summary: Get average rating
      description: Get the average rating for an application
      operationId: getAverageRatingForApplication
      parameters:
        - name: applicationId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Average rating
          content:
            application/json:
              schema:
                type: number
                format: double
              example: 4.5

  /v1/ratings/category-stats/{applicationId}:
    get:
      tags:
        - Ratings
      summary: Get rating statistics by category
      description: Get the count of ratings for each rating value (1-5 stars)
      operationId: getCategoryStatsForApplication
      parameters:
        - name: applicationId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Rating statistics
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ApplicationRatingStats'
              example:
                - id:
                    applicationId: "123e4567-e89b-12d3-a456-426614174000"
                    rating: 5
                  count: 100
                - id:
                    applicationId: "123e4567-e89b-12d3-a456-426614174000"
                    rating: 4
                  count: 50

  /v1/ratings:
    post:
      tags:
        - Ratings
      summary: Submit a rating
      description: Submit a new rating for an application
      operationId: submitRating
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RatingSubmitRequest'
            example:
              rating: 5
              applicationId: "123e4567-e89b-12d3-a456-426614174000"
              userName: "john_doe"
      responses:
        '200':
          description: Rating submitted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RatingSubmissionResponse'
        '400':
          description: Invalid rating value

  /v1/comments/application/{applicationId}:
    get:
      tags:
        - Comments
      summary: Get comments for an application
      description: Retrieve paginated comments/reviews for an application
      operationId: getComments
      parameters:
        - name: applicationId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: parentId
          in: query
          required: false
          description: Parent comment ID (null for root reviews)
          schema:
            type: string
            format: uuid
        - name: sentiment
          in: query
          required: false
          description: Filter by sentiment (1=positive, -1=negative)
          schema:
            type: integer
            enum: [1, -1]
        - name: userId
          in: query
          required: false
          description: Filter by user ID
          schema:
            type: string
            format: uuid
        - name: page
          in: query
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
        - name: size
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
        - name: sortBy
          in: query
          required: false
          schema:
            type: string
            default: updatedAt
        - name: order
          in: query
          required: false
          schema:
            type: string
            enum: [asc, desc]
            default: desc
      responses:
        '200':
          description: Paginated list of comments
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommentPage'

  /v1/comments/user/{userId}/application/{applicationId}:
    get:
      tags:
        - Comments
      summary: Get user's comments for an application
      description: Get all comments made by a specific user for an application, with context
      operationId: getUserCommentsForApplication
      parameters:
        - name: applicationId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: userId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: sentiment
          in: query
          required: false
          schema:
            type: integer
            enum: [1, -1]
        - name: page
          in: query
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
        - name: size
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
      responses:
        '200':
          description: User's comments with context
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserCommentsResponse'

  /v1/comments:
    post:
      tags:
        - Comments
      summary: Add a comment or review
      description: Add a new comment or review (parentId null for review)
      operationId: addComment
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddCommentRequest'
            example:
              applicationId: "123e4567-e89b-12d3-a456-426614174000"
              parentId: null
              sentiment: 1
              userId: "223e4567-e89b-12d3-a456-426614174001"
              text: "Great app! Very intuitive and easy to use."
      responses:
        '200':
          description: Comment added successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommentPage'

  /v1/comments/{id}:
    put:
      tags:
        - Comments
      summary: Update a comment
      description: Update the text or sentiment of an existing comment
      operationId: updateComment
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateCommentRequest'
            example:
              text: "Updated comment text"
              sentiment: 1
      responses:
        '200':
          description: Comment updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommentPage'
        '404':
          description: Comment not found

    delete:
      tags:
        - Comments
      summary: Delete a comment
      description: Delete a comment or review
      operationId: deleteComment
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: applicationId
          in: query
          required: true
          schema:
            type: string
            format: uuid
        - name: parentId
          in: query
          required: false
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Comment deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommentPage'
        '404':
          description: Comment not found

  /v1/comments/tree/{applicationId}:
    get:
      tags:
        - Comments
      summary: Get comment tree
      description: Get the full comment tree for an application
      operationId: getCommentTree
      parameters:
        - name: applicationId
          in: path
          required: true
          schema:
            type: string
        - name: userId
          in: query
          required: false
          schema:
            type: string
      responses:
        '200':
          description: Full comment tree
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Comment'

components:
  schemas:
    HealthResponse:
      type: object
      properties:
        status:
          type: string
          example: "UP"
        application:
          type: string
          example: "Ratings and Reviews System"
        version:
          type: string
          example: "1.0.0"

    DatabaseHealthResponse:
      type: object
      properties:
        status:
          type: string
          example: "UP"
        database:
          type: string
          example: "PostgreSQL"
        totalConnections:
          type: integer
          example: 10
        activeConnections:
          type: integer
          example: 2
        idleConnections:
          type: integer
          example: 8
        error:
          type: string
          description: Error message if status is DOWN

    Application:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      example:
        id: "123e4567-e89b-12d3-a456-426614174000"
        name: "Photo Editor Pro"
        description: "Professional photo editing application"
        createdAt: "2024-01-15T10:30:00Z"
        updatedAt: "2024-01-20T14:45:00Z"

    ApplicationPage:
      type: object
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/Application'
        pageable:
          $ref: '#/components/schemas/Pageable'
        totalPages:
          type: integer
        totalElements:
          type: integer
        last:
          type: boolean
        size:
          type: integer
        number:
          type: integer
        sort:
          $ref: '#/components/schemas/Sort'
        numberOfElements:
          type: integer
        first:
          type: boolean
        empty:
          type: boolean

    ApplicationIdRequest:
      type: object
      required:
        - applicationId
      properties:
        applicationId:
          type: string

    ApplicationIdsRequest:
      type: object
      required:
        - applicationIds
      properties:
        applicationIds:
          type: array
          items:
            type: string

    Rating:
      type: object
      properties:
        id:
          type: string
          format: uuid
        rating:
          type: integer
          minimum: 1
          maximum: 5
        applicationId:
          type: string
          format: uuid
        userName:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      example:
        id: "323e4567-e89b-12d3-a456-426614174002"
        rating: 5
        applicationId: "123e4567-e89b-12d3-a456-426614174000"
        userName: "john_doe"
        createdAt: "2024-01-15T10:30:00Z"
        updatedAt: "2024-01-15T10:30:00Z"

    RatingPage:
      type: object
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/Rating'
        pageable:
          $ref: '#/components/schemas/Pageable'
        totalPages:
          type: integer
        totalElements:
          type: integer
        last:
          type: boolean
        size:
          type: integer
        number:
          type: integer
        sort:
          $ref: '#/components/schemas/Sort'
        numberOfElements:
          type: integer
        first:
          type: boolean
        empty:
          type: boolean

    RatingSubmitRequest:
      type: object
      required:
        - rating
        - applicationId
        - userName
      properties:
        rating:
          type: integer
          minimum: 1
          maximum: 5
        applicationId:
          type: string
          format: uuid
        userName:
          type: string

    ApplicationRatingStats:
      type: object
      properties:
        id:
          type: object
          properties:
            applicationId:
              type: string
              format: uuid
            rating:
              type: integer
              minimum: 1
              maximum: 5
        count:
          type: integer
          format: int64

    RatingSubmissionResponse:
      type: object
      properties:
        savedRating:
          $ref: '#/components/schemas/Rating'
        newAverage:
          type: number
          format: double
        newCategoryStats:
          type: array
          items:
            $ref: '#/components/schemas/ApplicationRatingStats'
        page:
          $ref: '#/components/schemas/RatingPage'

    Comment:
      type: object
      properties:
        id:
          type: string
          format: uuid
        applicationId:
          type: string
          format: uuid
        userId:
          type: string
          format: uuid
        text:
          type: string
        sentiment:
          type: integer
          description: 1=positive, -1=negative, null=neutral
          enum: [1, -1]
          nullable: true
        level:
          type: integer
          format: int64
          description: 0 for root/review, >0 for nested comments
        parentId:
          type: string
          format: uuid
          nullable: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        children:
          type: array
          items:
            $ref: '#/components/schemas/Comment'
      example:
        id: "423e4567-e89b-12d3-a456-426614174003"
        applicationId: "123e4567-e89b-12d3-a456-426614174000"
        userId: "223e4567-e89b-12d3-a456-426614174001"
        text: "Great app!"
        sentiment: 1
        level: 0
        parentId: null
        createdAt: "2024-01-15T10:30:00Z"
        updatedAt: "2024-01-15T10:30:00Z"
        children: []

    CommentPage:
      type: object
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/Comment'
        pageable:
          $ref: '#/components/schemas/Pageable'
        totalPages:
          type: integer
        totalElements:
          type: integer
        last:
          type: boolean
        size:
          type: integer
        number:
          type: integer
        sort:
          $ref: '#/components/schemas/Sort'
        numberOfElements:
          type: integer
        first:
          type: boolean
        empty:
          type: boolean

    AddCommentRequest:
      type: object
      required:
        - applicationId
        - userId
        - text
      properties:
        applicationId:
          type: string
        parentId:
          type: string
          nullable: true
        sentiment:
          type: integer
          enum: [1, -1]
          nullable: true
        userId:
          type: string
        text:
          type: string

    UpdateCommentRequest:
      type: object
      required:
        - text
      properties:
        text:
          type: string
        sentiment:
          type: integer
          enum: [1, -1]
          nullable: true

    UserCommentsResponse:
      type: object
      properties:
        threads:
          type: array
          items:
            type: object
            description: Comment thread view with ancestor chain
        totalElements:
          type: integer
          format: int64

    Pageable:
      type: object
      properties:
        sort:
          $ref: '#/components/schemas/Sort'
        offset:
          type: integer
          format: int64
        pageNumber:
          type: integer
        pageSize:
          type: integer
        paged:
          type: boolean
        unpaged:
          type: boolean

    Sort:
      type: object
      properties:
        empty:
          type: boolean
        sorted:
          type: boolean
        unsorted:
          type: boolean
