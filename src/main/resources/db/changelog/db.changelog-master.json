{
  "databaseChangeLog": [
    {
      "changeSet": {
        "id": "1",
        "author": "rohan",
        "changes": [
          {
            "sql": "CREATE TABLE applications (id UUID PRIMARY KEY DEFAULT gen_random_uuid(), name VARCHAR(255), description TEXT, created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP);"
          },
          {
            "sql": "CREATE TRIGGER update_applications_updated_at BEFORE UPDATE ON applications FOR EACH ROW EXECUTE FUNCTION ratings_reviews.update_updated_at_column();"
          },
          {
            "sql": "CREATE INDEX idx_applications_name_gin_trgm ON applications USING gin (name gin_trgm_ops);"
          }
        ]
      }
    },
    {
      "changeSet": {
        "id": "2",
        "author": "rohan",
        "changes": [
          {
            "sql": "CREATE TABLE ratings (id UUID PRIMARY KEY DEFAULT gen_random_uuid(), application_id UUID REFERENCES applications(id) ON DELETE CASCADE, rating INT CHECK (rating >= 1 AND rating <= 5), user_name VARCHAR(255), created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP);"
          },
          {
            "sql": "CREATE TRIGGER update_ratings_updated_at BEFORE UPDATE ON ratings FOR EACH ROW EXECUTE FUNCTION ratings_reviews.update_updated_at_column();"
          },
          {
            "sql": "CREATE INDEX idx_ratings_application_id ON ratings(application_id);"
          }
        ]
      }
    },
    {
      "changeSet": {
        "id": "3",
        "author": "rohan",
        "changes": [
          {
            "sql": "CREATE TABLE application_rating_stats ( application_id UUID, scale smallint default 0, count bigint DEFAULT 0 , PRIMARY KEY (application_id, scale));"
          }
        ]
      }
    },
    {
      "changeSet": {
        "id": "4",
        "author": "rohan",
        "changes": [
          {
            "sql": "CREATE TRIGGER ratings_stats_insert AFTER INSERT ON ratings FOR EACH ROW EXECUTE FUNCTION ratings_reviews.update_application_rating_stats();"
          }
        ]
      }
    }
  ]
}